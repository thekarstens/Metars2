<body class="">
<div id="banner" class="tvbanner">APR 2018 CASE STUDY</div>
<div id="map" class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0" style="position: relative; outline-style: none;"><div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(-1134px, 1318.79px, 0px);"><div class="leaflet-pane leaflet-tile-pane"><div class="leaflet-layer " style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 19; transform: translate3d(172px, -206px, 0px) scale(1);"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/14/22.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1223px, -1031px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/15/22.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1479px, -1031px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/14/23.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1223px, -775px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/15/23.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1479px, -775px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/14/21.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1223px, -1287px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/15/21.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1479px, -1287px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/14/24.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1223px, -519px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/15/24.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1479px, -519px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/13/22.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(967px, -1031px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/16/22.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1735px, -1031px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/13/23.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(967px, -775px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/16/23.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1735px, -775px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/13/21.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(967px, -1287px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/16/21.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1735px, -1287px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/13/24.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(967px, -519px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/16/24.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1735px, -519px, 0px); opacity: 1;"><img alt="" src="https://b.basemaps.cartocdn.com/light_nolabels/6/12/22.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(711px, -1031px, 0px); opacity: 1;"><img alt="" src="https://c.basemaps.cartocdn.com/light_nolabels/6/12/23.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(711px, -775px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/12/21.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(711px, -1287px, 0px); opacity: 1;"><img alt="" src="https://a.basemaps.cartocdn.com/light_nolabels/6/12/24.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(711px, -519px, 0px); opacity: 1;"></div><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(-9px, 5px, 0px) scale(2);"></div></div></div><div class="leaflet-pane leaflet-overlay-pane"><svg pointer-events="none" class="leaflet-zoom-animated" width="1235" height="757" viewBox="1031 -1382 1235 757" style="transform: translate3d(1031px, -1382px, 0px);"><g></g></svg><canvas class="leaflet-layer leaflet-zoom-animated velocity-overlay" width="1029" height="631" style="transform: translate3d(1134px, -1318.79px, 0px);"></canvas></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-marker-pane"><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1313px, -914px, 0px); z-index: -914;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1433px, -1011px, 0px); z-index: -1011;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,160,20);
                     border-color:#333;
                     font-size:12px;">39</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1524px, -1004px, 0px); z-index: -1004;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,100,140);
                     border-color:#333;
                     font-size:12px;">33</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1439px, -936px, 0px); z-index: -936;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(13,83,206);
                     border-color:#333;
                     font-size:12px;">29</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1581px, -970px, 0px); z-index: -970;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1541px, -897px, 0px); z-index: -897;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1459px, -873px, 0px); z-index: -873;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1280px, -942px, 0px); z-index: -942;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1533px, -936px, 0px); z-index: -936;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1379px, -915px, 0px); z-index: -915;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1585px, -912px, 0px); z-index: -912;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(84,154,239);
                     border-color:#333;
                     font-size:12px;">23</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1589px, -1019px, 0px); z-index: -1019;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1571px, -844px, 0px); z-index: -844;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1360px, -977px, 0px); z-index: -977;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1290px, -1014px, 0px); z-index: -1014;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(13,83,206);
                     border-color:#333;
                     font-size:12px;">29</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1648px, -1232px, 0px); z-index: -1232;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1637px, -1124px, 0px); z-index: -1124;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2147px, -888px, 0px); z-index: -888;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1652px, -927px, 0px); z-index: -927;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(58,128,226);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2005px, -731px, 0px); z-index: -731;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(99,226,99);
                     border-color:#333;
                     font-size:12px;">47</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1741px, -1159px, 0px); z-index: -1159;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1773px, -1020px, 0px); z-index: -1020;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1650px, -997px, 0px); z-index: -997;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1793px, -1135px, 0px); z-index: -1135;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,70,200);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1902px, -790px, 0px); z-index: -790;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,153,34);
                     border-color:#333;
                     font-size:12px;">38</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1873px, -909px, 0px); z-index: -909;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(6,76,203);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1992px, -554px, 0px); z-index: -554;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,185,0);
                     border-color:#333;
                     font-size:12px;">65</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1974px, -928px, 0px); z-index: -928;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1996px, -856px, 0px); z-index: -856;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1951px, -825px, 0px); z-index: -825;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,144,52);
                     border-color:#333;
                     font-size:12px;">37</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2004px, -1138px, 0px); z-index: -1138;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(71,141,232);
                     border-color:#333;
                     font-size:12px;">24</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2001px, -785px, 0px); z-index: -785;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,150,40);
                     border-color:#333;
                     font-size:12px;">38</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1386px, -1150px, 0px); z-index: -1150;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(13,83,206);
                     border-color:#333;
                     font-size:12px;">29</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1286px, -1186px, 0px); z-index: -1186;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,140,60);
                     border-color:#333;
                     font-size:12px;">37</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1829px, -780px, 0px); z-index: -780;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,170,0);
                     border-color:#333;
                     font-size:12px;">40</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1427px, -840px, 0px); z-index: -840;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1639px, -745px, 0px); z-index: -745;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,110,120);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1921px, -657px, 0px); z-index: -657;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(192,247,90);
                     border-color:#333;
                     font-size:12px;">54</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1617px, -811px, 0px); z-index: -811;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1691px, -874px, 0px); z-index: -874;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(71,141,232);
                     border-color:#333;
                     font-size:12px;">24</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1418px, -1091px, 0px); z-index: -1091;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,120,100);
                     border-color:#333;
                     font-size:12px;">35</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1884px, -753px, 0px); z-index: -753;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(30,187,30);
                     border-color:#333;
                     font-size:12px;">42</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1597px, -1101px, 0px); z-index: -1101;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,100,140);
                     border-color:#333;
                     font-size:12px;">33</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1580px, -1170px, 0px); z-index: -1170;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1331px, -1041px, 0px); z-index: -1041;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1985px, -668px, 0px); z-index: -668;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,207,0);
                     border-color:#333;
                     font-size:12px;">63</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1716px, -1106px, 0px); z-index: -1106;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1697px, -1224px, 0px); z-index: -1224;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,100,140);
                     border-color:#333;
                     font-size:12px;">33</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1777px, -1175px, 0px); z-index: -1175;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1931px, -1016px, 0px); z-index: -1016;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1311px, -839px, 0px); z-index: -839;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2150px, -934px, 0px); z-index: -934;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2070px, -795px, 0px); z-index: -795;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,170,0);
                     border-color:#333;
                     font-size:12px;">40</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1719px, -1067px, 0px); z-index: -1067;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2225px, -812px, 0px); z-index: -812;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,130,80);
                     border-color:#333;
                     font-size:12px;">36</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2108px, -959px, 0px); z-index: -959;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1749px, -964px, 0px); z-index: -964;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2177px, -779px, 0px); z-index: -779;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,160,20);
                     border-color:#333;
                     font-size:12px;">39</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1324px, -790px, 0px); z-index: -790;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1468px, -753px, 0px); z-index: -753;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1378px, -697px, 0px); z-index: -697;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(13,83,206);
                     border-color:#333;
                     font-size:12px;">29</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1425px, -679px, 0px); z-index: -679;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1421px, -734px, 0px); z-index: -734;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2016px, -594px, 0px); z-index: -594;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,178,0);
                     border-color:#333;
                     font-size:12px;">66</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1841px, -1042px, 0px); z-index: -1042;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1774px, -794px, 0px); z-index: -794;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,150,40);
                     border-color:#333;
                     font-size:12px;">38</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1756px, -858px, 0px); z-index: -858;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,70,200);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2148px, -976px, 0px); z-index: -976;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(108,178,250);
                     border-color:#333;
                     font-size:12px;">21</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1865px, -1076px, 0px); z-index: -1076;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(71,141,232);
                     border-color:#333;
                     font-size:12px;">24</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1529px, -724px, 0px); z-index: -724;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1723px, -1010px, 0px); z-index: -1010;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2005px, -897px, 0px); z-index: -897;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2191px, -847px, 0px); z-index: -847;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2111px, -841px, 0px); z-index: -841;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,100,140);
                     border-color:#333;
                     font-size:12px;">33</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2154px, -835px, 0px); z-index: -835;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1796px, -732px, 0px); z-index: -732;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(45,196,45);
                     border-color:#333;
                     font-size:12px;">43</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1856px, -713px, 0px); z-index: -713;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(75,213,75);
                     border-color:#333;
                     font-size:12px;">45</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1729px, -704px, 0px); z-index: -704;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(45,196,45);
                     border-color:#333;
                     font-size:12px;">43</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1676px, -1100px, 0px); z-index: -1100;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(13,83,206);
                     border-color:#333;
                     font-size:12px;">29</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1876px, -858px, 0px); z-index: -858;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,120,100);
                     border-color:#333;
                     font-size:12px;">35</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1653px, -671px, 0px); z-index: -671;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,170,0);
                     border-color:#333;
                     font-size:12px;">40</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1900px, -582px, 0px); z-index: -582;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(182,249,105);
                     border-color:#333;
                     font-size:12px;">53</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2109px, -801px, 0px); z-index: -801;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,150,40);
                     border-color:#333;
                     font-size:12px;">38</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1394px, -1191px, 0px); z-index: -1191;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,110,120);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1993px, -1028px, 0px); z-index: -1028;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2200px, -980px, 0px); z-index: -980;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(84,154,239);
                     border-color:#333;
                     font-size:12px;">23</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1853px, -663px, 0px); z-index: -663;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(135,247,135);
                     border-color:#333;
                     font-size:12px;">49</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1599px, -716px, 0px); z-index: -716;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1898px, -952px, 0px); z-index: -952;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1741px, -759px, 0px); z-index: -759;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(15,179,15);
                     border-color:#333;
                     font-size:12px;">41</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1921px, -706px, 0px); z-index: -706;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(105,230,105);
                     border-color:#333;
                     font-size:12px;">47</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1271px, -1101px, 0px); z-index: -1101;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1487px, -1206px, 0px); z-index: -1206;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,126,88);
                     border-color:#333;
                     font-size:12px;">36</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1491px, -1137px, 0px); z-index: -1137;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1560px, -1227px, 0px); z-index: -1227;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,126,88);
                     border-color:#333;
                     font-size:12px;">36</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1302px, -1237px, 0px); z-index: -1237;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1538px, -1135px, 0px); z-index: -1135;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1828px, -866px, 0px); z-index: -866;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1441px, -1055px, 0px); z-index: -1055;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,126,88);
                     border-color:#333;
                     font-size:12px;">36</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1342px, -1194px, 0px); z-index: -1194;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2226px, -898px, 0px); z-index: -898;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2192px, -1041px, 0px); z-index: -1041;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(54,124,225);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2247px, -843px, 0px); z-index: -843;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1627px, -1059px, 0px); z-index: -1059;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1794px, -949px, 0px); z-index: -949;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1829px, -916px, 0px); z-index: -916;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1689px, -790px, 0px); z-index: -790;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1559px, -1055px, 0px); z-index: -1055;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2081px, -1039px, 0px); z-index: -1039;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(43,113,220);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1622px, -958px, 0px); z-index: -958;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1793px, -1086px, 0px); z-index: -1086;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(84,154,239);
                     border-color:#333;
                     font-size:12px;">23</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1823px, -1162px, 0px); z-index: -1162;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1684px, -1265px, 0px); z-index: -1265;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1700px, -911px, 0px); z-index: -911;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(62,132,229);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1677px, -751px, 0px); z-index: -751;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,144,52);
                     border-color:#333;
                     font-size:12px;">37</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1678px, -710px, 0px); z-index: -710;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(15,179,15);
                     border-color:#333;
                     font-size:12px;">41</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1843px, -1123px, 0px); z-index: -1123;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(84,154,239);
                     border-color:#333;
                     font-size:12px;">23</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1455px, -1160px, 0px); z-index: -1160;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2151px, -1031px, 0px); z-index: -1031;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(62,132,229);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1708px, -966px, 0px); z-index: -966;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(52,122,224);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1817px, -829px, 0px); z-index: -829;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1669px, -824px, 0px); z-index: -824;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(41,111,219);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1285px, -738px, 0px); z-index: -738;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,117,106);
                     border-color:#333;
                     font-size:12px;">35</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1624px, -888px, 0px); z-index: -888;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(41,111,219);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2163px, -1072px, 0px); z-index: -1072;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(36,106,217);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1540px, -770px, 0px); z-index: -770;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(35,105,216);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1462px, -714px, 0px); z-index: -714;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(35,105,216);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1948px, -579px, 0px); z-index: -579;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,169,0);
                     border-color:#333;
                     font-size:12px;">67</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2070px, -909px, 0px); z-index: -909;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,81,178);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1778px, -913px, 0px); z-index: -913;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(41,111,219);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1701px, -1184px, 0px); z-index: -1184;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1752px, -1212px, 0px); z-index: -1212;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1631px, -848px, 0px); z-index: -848;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(41,111,219);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2035px, -984px, 0px); z-index: -984;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(47,117,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1908px, -882px, 0px); z-index: -882;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1943px, -496px, 0px); z-index: -496;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,172,0);
                     border-color:#333;
                     font-size:12px;">67</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1890px, -1163px, 0px); z-index: -1163;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(106,176,248);
                     border-color:#333;
                     font-size:12px;">21</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1682px, -1021px, 0px); z-index: -1021;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(32,102,215);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1426px, -785px, 0px); z-index: -785;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(52,122,224);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1946px, -747px, 0px); z-index: -747;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(72,211,72);
                     border-color:#333;
                     font-size:12px;">45</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1817px, -1008px, 0px); z-index: -1008;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(19,89,209);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1861px, -1007px, 0px); z-index: -1007;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(52,122,224);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1353px, -837px, 0px); z-index: -837;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(41,111,219);
                     border-color:#333;
                     font-size:12px;">27</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1731px, -814px, 0px); z-index: -814;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,108,124);
                     border-color:#333;
                     font-size:12px;">34</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1562px, -675px, 0px); z-index: -675;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2089px, -876px, 0px); z-index: -876;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,90,160);
                     border-color:#333;
                     font-size:12px;">32</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2114px, -1061px, 0px); z-index: -1061;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(78,148,236);
                     border-color:#333;
                     font-size:12px;">24</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2208px, -940px, 0px); z-index: -940;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(52,122,224);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1922px, -617px, 0px); z-index: -617;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,210,0);
                     border-color:#333;
                     font-size:12px;">63</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1974px, -612px, 0px); z-index: -612;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(255,171,0);
                     border-color:#333;
                     font-size:12px;">67</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1682px, -1140px, 0px); z-index: -1140;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,72,196);
                     border-color:#333;
                     font-size:12px;">30</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1324px, -1093px, 0px); z-index: -1093;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1512px, -1102px, 0px); z-index: -1102;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,79,182);
                     border-color:#333;
                     font-size:12px;">31</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1839px, -967px, 0px); z-index: -967;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(60,130,228);
                     border-color:#333;
                     font-size:12px;">25</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2039px, -1022px, 0px); z-index: -1022;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(24,94,211);
                     border-color:#333;
                     font-size:12px;">28</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1626px, -1178px, 0px); z-index: -1178;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,120,100);
                     border-color:#333;
                     font-size:12px;">35</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1367px, -1094px, 0px); z-index: -1094;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(0,126,88);
                     border-color:#333;
                     font-size:12px;">36</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1512px, -816px, 0px); z-index: -816;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(46,116,221);
                     border-color:#333;
                     font-size:12px;">26</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(1952px, -535px, 0px); z-index: -535;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(205,245,72);
                     border-color:#333;
                     font-size:12px;">55</div></div><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -14px; margin-top: -14px; width: 28px; height: 28px; transform: translate3d(2026px, -1063px, 0px); z-index: -1063;"><div class="dot" style="width:28px;height:28px;
                     background:rgb(62,132,229);
                     border-color:#333;
                     font-size:12px;">25</div></div></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(3837.5px, 5865.71px, 0px) scale(32);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in" aria-disabled="false"><span aria-hidden="true">+</span></a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true"></span></a></div></div><div class="leaflet-top leaflet-right"><div class="leaflet-control-layers leaflet-control-layers-expanded leaflet-control" aria-haspopup="true"><a class="leaflet-control-layers-toggle" href="#" title="Layers" role="button"></a><section class="leaflet-control-layers-list"><div class="leaflet-control-layers-base"><label><span><input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers_76" checked="checked"><span> OpenStreetMap</span></span></label></div><div class="leaflet-control-layers-separator"></div><div class="leaflet-control-layers-overlays"><label><span><input type="checkbox" class="leaflet-control-layers-selector" checked=""><span> Temperature (F)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Dew Point (F)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Wind Speed (mph)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Wind Arrows</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Wind Gusts (mph)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Visibility (mi)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Pressure (trend)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Weather Codes</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Alerts (WWA)</span></span></label><label><span><input type="checkbox" class="leaflet-control-layers-selector"><span> Daily wind particles</span></span></label></div></section></div></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"> OpenStreetMap contributors</div></div></div></div>
<img id="brandLogo" src="logo.png" alt="Weather Workshops">

<div class="panel">
  <div style="font-size:13px;margin-bottom:6px">Apr 2018 Case Study</div>

  <!-- Time controls for METAR + Alerts -->
  <div class="row">
    <button class="btn" id="backBtn"> Time</button>
    <div class="mono" id="timeLabel">2018-04-14 18Z</div>
    <button class="btn" id="fwdBtn">Time </button>
  </div>

  <!-- Day controls for PARTICLES ONLY -->
  <div class="row">
    <span class="tiny">Particles day:</span>
    <button class="btn" id="dayBackBtn"> Apr 13</button>
    <div class="mono" id="dayLabel">Apr 14</div>
    <button class="btn" id="dayFwdBtn">Apr 15 </button>
  </div>

  <div class="row">
    <span style="opacity:.75">Step:</span>
    <span class="mono">3 hours</span>
    <span style="opacity:.75;margin-left:auto">Zoom:</span>
    <span class="mono" id="zoomLabel">6</span>
  </div>

  <div class="row">
    <span class="tiny" id="status">Stations shown: 10499/10499 (minSep 38px).</span>
  </div>

  <div class="tiny">
    Wind arrows: direction wind is blowing <b>TO</b> (METAR direction + 180).
  </div>
</div>

<script>
/* ------------------------------------------------------------
   1) Map
------------------------------------------------------------ */
const map = L.map("map", { zoomControl:true }).setView([44.2, -96.5], 6);

const osm = L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png", {
  maxZoom: 19,
  attribution: " OpenStreetMap contributors"
}).addTo(map);

map.attributionControl.setPrefix(false);

const statusEl    = document.getElementById("status");
const timeLabelEl = document.getElementById("timeLabel");
const dayLabelEl  = document.getElementById("dayLabel");
const zoomLabelEl = document.getElementById("zoomLabel");

function setStatus(msg){ statusEl.textContent = msg; }

map.on("zoomend", ()=>zoomLabelEl.textContent = String(map.getZoom()));
zoomLabelEl.textContent = String(map.getZoom());

/* ------------------------------------------------------------
   2) Time controls (METAR + Alerts)
------------------------------------------------------------ */
let current = new Date(Date.UTC(2018, 3, 14, 15, 0, 0)); // default (will snap to timeline)
const stepHours = 3;

// Alerts timeline index (optional, but recommended)
let ALERTS_TIMELINE = null; // array of {t, file, count}
let ALERTS_MIN = null;
let ALERTS_MAX = null;

function parseISOZ(s){
  // '2018-04-12T00:00:00Z' -> Date
  const d = new Date(s);
  return isNaN(d.getTime()) ? null : d;
}

async function loadAlertsTimelineIndex(){
  try {
    const r = await fetch('./timeline_index.json', { cache:'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const idx = await r.json();
    if (!Array.isArray(idx) || !idx.length) throw new Error('empty index');
    ALERTS_TIMELINE = idx
      .map(x => ({...x, _d: parseISOZ(x.t)}))
      .filter(x => x._d);
    ALERTS_TIMELINE.sort((a,b)=>a._d-b._d);
    ALERTS_MIN = ALERTS_TIMELINE[0]._d;
    ALERTS_MAX = ALERTS_TIMELINE[ALERTS_TIMELINE.length-1]._d;
  } catch(e){
    // Not fatal: we'll fall back to the old per-hour filenames
    console.warn('No timeline_index.json found or unreadable:', e.message);
    ALERTS_TIMELINE = null;
    ALERTS_MIN = null;
    ALERTS_MAX = null;
  }
}

function snapCurrentToAlertsTimeline(){
  if (!ALERTS_TIMELINE || !ALERTS_TIMELINE.length) return null;
  // clamp
  if (current < ALERTS_MIN) current = new Date(ALERTS_MIN.getTime());
  if (current > ALERTS_MAX) current = new Date(ALERTS_MAX.getTime());
  // nearest
  let best = ALERTS_TIMELINE[0];
  let bestDt = Math.abs(current - best._d);
  for (let i=1;i<ALERTS_TIMELINE.length;i++){
    const it = ALERTS_TIMELINE[i];
    const dt = Math.abs(current - it._d);
    if (dt < bestDt){ best = it; bestDt = dt; }
  }
  // snap label/time to the actual frame time to avoid confusing 'out of range' times
  current = new Date(best._d.getTime());
  return best;
}


function fmtZ(d){
  const Y = d.getUTCFullYear();
  const M = String(d.getUTCMonth()+1).padStart(2,"0");
  const D = String(d.getUTCDate()).padStart(2,"0");
  const H = String(d.getUTCHours()).padStart(2,"0");
  return `${Y}-${M}-${D} ${H}Z`;
}
function toISOZ(d){
  const Y = d.getUTCFullYear();
  const M = String(d.getUTCMonth()+1).padStart(2,"0");
  const D = String(d.getUTCDate()).padStart(2,"0");
  const H = String(d.getUTCHours()).padStart(2,"0");
  return `${Y}-${M}-${D}T${H}:00:00Z`;
}
function updateTimeLabel(){ timeLabelEl.textContent = fmtZ(current); }
updateTimeLabel();

// Try to load alerts timeline index (if present in repo)
loadAlertsTimelineIndex().then(()=>{
  snapCurrentToAlertsTimeline();
  updateTimeLabel();
});

document.getElementById("backBtn").onclick = async () => {
  current = new Date(current.getTime() - stepHours*3600*1000);
  snapCurrentToAlertsTimeline();
  updateTimeLabel();
  await refreshAll();
};
document.getElementById("fwdBtn").onclick = async () => {
  current = new Date(current.getTime() + stepHours*3600*1000);
  snapCurrentToAlertsTimeline();
  updateTimeLabel();
  await refreshAll();
};

/* ------------------------------------------------------------
   3) Day controls (Particles only: Apr 13/14/15)
------------------------------------------------------------ */
let particleDay = 14; // 13, 14, 15
function updateDayLabel(){
  dayLabelEl.textContent = (particleDay === 13) ? "Apr 13" : (particleDay === 15) ? "Apr 15" : "Apr 14";
}
updateDayLabel();

document.getElementById("dayBackBtn").onclick = async () => {
  particleDay = Math.max(13, particleDay - 1);
  updateDayLabel();
  await refreshParticlesIfOn();
};
document.getElementById("dayFwdBtn").onclick = async () => {
  particleDay = Math.min(15, particleDay + 1);
  updateDayLabel();
  await refreshParticlesIfOn();
};

/* ------------------------------------------------------------
   4) Layers
------------------------------------------------------------ */
const tempLayer = L.layerGroup().addTo(map);
const dewLayer  = L.layerGroup();
const windNumLayer = L.layerGroup();
const windArrowLayer = L.layerGroup();
const gustLayer = L.layerGroup();
const visLayer  = L.layerGroup();
const presLayer = L.layerGroup();
const wxLayer   = L.layerGroup();

// Alerts
const alertsLayer = L.geoJSON(null);

// Particles: placeholder for checkbox + actual velocity layer
const particlesToggle = L.layerGroup();
let particlesLayer = null;


  // =========================
  // EXTRA LAYERS: Composite Radar (obs), MODIS, Jet Stream
  // =========================

  // --- Composite radar (PNG frames in ./radar_frames/) ---
  obsRadarToggle = L.layerGroup();
  // Initialize first frame once toggle exists
  try { updateObsRadar(); } catch(e) { console.warn("updateObsRadar init", e); }
// this is what goes in the toggle box
  let obsRadarOverlay = null;
  let obsRadarBounds = null;

  // Manual nudge requested: ~60 miles south and ~15 miles east (approx degrees)
  const RADAR_LAT_SHIFT = -0.87;  // deg latitude (~60 mi)
  const RADAR_LON_SHIFT =  0.27;  // deg longitude (~15 mi near 45N)

  function ymd(dt){
    const y = dt.getUTCFullYear();
    const m = String(dt.getUTCMonth()+1).padStart(2,'0');
    const d = String(dt.getUTCDate()).padStart(2,'0');
    return `${y}${m}${d}`;
  }
  function hhmm(dt){
    const h = String(dt.getUTCHours()).padStart(2,'0');
    const min = String(dt.getUTCMinutes()).padStart(2,'0');
    return `${h}${min}`;
  }

  // Snap to nearest 3-hour frame at minute 00
  function snap3h(dt){
    const t = new Date(dt.getTime());
    t.setUTCMinutes(0,0,0);
    const h = t.getUTCHours();
    const snapped = Math.round(h/3)*3;
    t.setUTCHours((snapped+24)%24);
    return t;
  }

  function radarFilenameFor(dt){
    const t = snap3h(dt);
    return `radar_frames/n0q_${ymd(t)}${String(t.getUTCHours()).padStart(2,'0')}00.png`;
  }

  function applyRadarBoundsShift(b){
    const s = b.south + RADAR_LAT_SHIFT;
    const n = b.north + RADAR_LAT_SHIFT;
    const w = b.west  + RADAR_LON_SHIFT;
    const e = b.east  + RADAR_LON_SHIFT;
    return [[s,w],[n,e]];
  }

  // Load bounds once
  fetch('radar_frames/radar_bounds.json')
    .then(r => r.ok ? r.json() : Promise.reject(new Error('Missing radar_bounds.json')))
    .then(b => {
      obsRadarBounds = applyRadarBoundsShift(b);
      // If the layer is toggled on already, draw immediately
    })
    .catch(err => console.warn('Radar bounds not loaded:', err));

  function updateObsRadar(){
    if (!obsRadarBounds) return;
    const file = radarFilenameFor(current);
    // Remove old overlay
    if (obsRadarOverlay){
      obsRadarToggle.removeLayer(obsRadarOverlay);
      obsRadarOverlay = null;
    }
    obsRadarOverlay = L.imageOverlay(file, obsRadarBounds, {opacity: 0.65, className:'obs-radar'});
    obsRadarToggle.addLayer(obsRadarOverlay);
    // If toggle currently on, keep it on the map
    if (map.hasLayer(obsRadarToggle)){
      obsRadarToggle.addTo(map);
    }
  }

  // --- MODIS True Color (NASA GIBS) ---
  const modisToggle = L.tileLayer(
    'https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/2018-04-14/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg',
    {opacity: 0.85, attribution: 'NASA GIBS'}
  );

  // --- Jet Stream particles (Leaflet-Velocity) ---
  const jetToggle = L.layerGroup();
  let jetVelocity = null;

  function tryFetchFirst(urls){
    // returns promise that resolves with first successful JSON
    let chain = Promise.reject();
    urls.forEach(u=>{
      chain = chain.catch(()=>fetch(u).then(r=>r.ok ? r.json() : Promise.reject()));
    });
    return chain;
  }

  function loadJetOnce(){
    if (jetVelocity) return;
    const candidates = [
      'jetstream_2018041418z.json',
      'jetstream_2018041418Z.json',
      'jetstream_20180414_18z.json',
      'jetstream_20180414_18Z.json',
      'jetstream_18z.json',
      'jetstream.json'
    ];
    tryFetchFirst(candidates)
      .then(data=>{
        jetVelocity = L.velocityLayer({
          displayValues: false,
          displayOptions: { velocityType: 'Jet Stream' },
          data: data,
          maxVelocity: 120
        });
        jetToggle.addLayer(jetVelocity);
        if (map.hasLayer(jetToggle)) jetToggle.addTo(map);
      })
      .catch(()=>console.warn('Jet stream JSON not found (expected one of):', candidates.join(', ')));
  }

  map.on('overlayadd', (e)=>{
    if (e.layer === jetToggle) loadJetOnce();
  });


L.control.layers(
  { "OpenStreetMap": osm },
  {
    "Temperature (F)": tempLayer,
    "Dew Point (F)": dewLayer,
    "Wind Speed (mph)": windNumLayer,
    "Wind Arrows": windArrowLayer,
    "Wind Gusts (mph)": gustLayer,
    "Visibility (mi)": visLayer,
    "Pressure (trend)": presLayer,
    "Weather Codes": wxLayer,
    "Alerts (WWA)": alertsLayer,
    "Daily wind particles": particlesToggle
  },
  { collapsed:false }
).addTo(map);

/* ------------------------------------------------------------
   5) Collision thinning (drop stations if overlapping)
------------------------------------------------------------ */
class CollisionIndex {
  constructor(cellSizePx){
    this.cell = cellSizePx;
    this.grid = new Map();
  }
  _key(cx, cy){ return `${cx},${cy}`; }
  _cellOf(p){ return [Math.floor(p.x / this.cell), Math.floor(p.y / this.cell)]; }
  canPlace(p, minSepPx){
    const [cx, cy] = this._cellOf(p);
    const r2 = minSepPx * minSepPx;
    for (let dx=-1; dx<=1; dx++){
      for (let dy=-1; dy<=1; dy++){
        const key = this._key(cx+dx, cy+dy);
        const arr = this.grid.get(key);
        if (!arr) continue;
        for (const q of arr){
          const ddx = p.x - q.x;
          const ddy = p.y - q.y;
          if ((ddx*ddx + ddy*ddy) < r2) return false;
        }
      }
    }
    const key = this._key(cx, cy);
    if (!this.grid.has(key)) this.grid.set(key, []);
    this.grid.get(key).push({x:p.x, y:p.y});
    return true;
  }
}

function minSepForZoom(z){
  if (z <= 4) return 54;
  if (z === 5) return 46;
  if (z === 6) return 38;
  if (z === 7) return 32;
  return 0; // z >= 8 show all
}
function allowByCollision(index, lat, lon, minSepPx){
  if (minSepPx <= 0) return true;
  const p = map.latLngToLayerPoint([lat, lon]);
  return index.canPlace(p, minSepPx);
}

/* ------------------------------------------------------------
   6) Color ramps
------------------------------------------------------------ */
function piecewiseColor(x, stops){
  if (x == null || !Number.isFinite(x)) return "rgb(255,255,255)";
  if (x <= stops[0].v) return `rgb(${stops[0].c.join(",")})`;
  if (x >= stops[stops.length-1].v) return `rgb(${stops[stops.length-1].c.join(",")})`;
  for (let i=0; i<stops.length-1; i++){
    const a = stops[i], b = stops[i+1];
    if (x >= a.v && x <= b.v){
      const k = (x - a.v) / (b.v - a.v);
      const r = Math.round(a.c[0] + (b.c[0]-a.c[0]) * k);
      const g = Math.round(a.c[1] + (b.c[1]-a.c[1]) * k);
      const bb= Math.round(a.c[2] + (b.c[2]-a.c[2]) * k);
      return `rgb(${r},${g},${bb})`;
    }
  }
  return "rgb(255,255,255)";
}

function tempColorF(t){
  return piecewiseColor(t, [
    {v: 10, c: [170, 220, 255]},
    {v: 20, c: [120, 190, 255]},
    {v: 30, c: [0, 70, 200]},
    {v: 40, c: [0, 170, 0]},
    {v: 50, c: [150, 255, 150]},
    {v: 60, c: [255, 235, 0]},
    {v: 70, c: [255, 140, 0]},
    {v: 85, c: [255, 80, 0]}
  ]);
}

function dewColorF(td){
  return piecewiseColor(td, [
    {v: 10, c: [90, 55, 20]},
    {v: 20, c: [140, 95, 40]},
    {v: 30, c: [200, 160, 110]},
    {v: 50, c: [190, 200, 140]},
    {v: 60, c: [0, 170, 0]},
    {v: 70, c: [0, 90, 0]}
  ]);
}

function windColorMph(spd){
  return piecewiseColor(spd, [
    {v: 0,  c: [0, 40, 160]},
    {v: 10, c: [0, 120, 255]},
    {v: 20, c: [0, 210, 180]},
    {v: 35, c: [255, 220, 0]},
    {v: 50, c: [255, 120, 0]},
    {v: 70, c: [255, 80, 0]}
  ]);
}

function pressureTrendColor(deltaInHg){
  if (deltaInHg == null || !Number.isFinite(deltaInHg)) return "rgb(248,248,248)";
  if (deltaInHg > 0.02)  return "rgb(215,245,215)";
  if (deltaInHg < -0.02) return "rgb(255,220,220)";
  return "rgb(240,240,240)";
}

function visStyle(vis){
  if (vis == null || !Number.isFinite(vis)) {
    return { bg:"rgba(255,255,255,0.65)", border:"#333" };
  }
  const v = Math.max(0, Math.min(10, vis));
  const alpha = 1 - (v / 10);
  const border = (v < 1) ? "#666" : "#333";
  return { bg:`rgba(255,255,255,${alpha.toFixed(3)})`, border };
}

/* ------------------------------------------------------------
   7) Icons
------------------------------------------------------------ */
function dotIcon(txt, fill, size=28, fontSize=12, borderColor="#333"){
  return L.divIcon({
    className:"",
    html:`<div class="dot"
              style="width:${size}px;height:${size}px;
                     background:${fill};
                     border-color:${borderColor};
                     font-size:${fontSize}px;">${txt}</div>`,
    iconSize:[size,size],
    iconAnchor:[size/2,size/2]
  });
}

/* Wind arrow as inline SVG divIcon */
function windArrowIcon(bearingDeg, mph){
  const spd = (mph == null || !Number.isFinite(mph)) ? 0 : mph;
  const color = windColorMph(spd);

  const Lmin = 14, Lmax = 52;
  const len = Math.max(Lmin, Math.min(Lmax, Lmin + spd * 0.65));

  const w = 60, h = 60;
  const cx = w/2, cy = h/2;

  const svg = `
    <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
      <g transform="translate(${cx},${cy})">
        <line x1="0" y1="${len/2}" x2="0" y2="${-len/2}" stroke="${color}" stroke-width="4" stroke-linecap="round"/>
        <polygon points="0,${-len/2-8} -8,${-len/2+6} 8,${-len/2+6}" fill="${color}"/>
      </g>
    </svg>
  `;

  return L.divIcon({
    className:"",
    html:`<div style="width:${w}px;height:${h}px;transform:rotate(${bearingDeg}deg);">
            ${svg}
          </div>`,
    iconSize:[w,h],
    iconAnchor:[w/2,h/2]
  });
}

/* ------------------------------------------------------------
   8) Helpers
------------------------------------------------------------ */
function num(v){
  const s = (v ?? "").toString().trim();
  if (!s) return null;
  const n = Number(s);
  return Number.isFinite(n) ? n : null;
}
function ktToMph(kt){ return kt == null ? null : (kt * 1.15078); }

function parseVisMiles(raw){
  if (raw == null) return { miles:null, label:"" };
  let s = String(raw).trim();
  if (!s) return { miles:null, label:"" };

  if (s.startsWith("M")) s = s.slice(1);
  s = s.replace(/\s+/g, " ");

  const n = Number(s);
  if (Number.isFinite(n)) return { miles:n, label:formatVisLabel(n) };

  const parts = s.split(" ");
  let whole = 0;
  let frac = null;

  if (parts.length === 2){
    whole = Number(parts[0]);
    frac = parts[1];
  } else {
    frac = parts[0];
  }

  if (frac && frac.includes("/")){
    const [a,b] = frac.split("/").map(Number);
    if (Number.isFinite(a) && Number.isFinite(b) && b !== 0){
      const val = (Number.isFinite(whole) ? whole : 0) + (a/b);
      return { miles:val, label:formatVisLabel(val) };
    }
  }
  return { miles:null, label:String(raw).trim() };
}
function formatVisLabel(x){
  if (!Number.isFinite(x)) return "";
  if (x >= 10) return "10+";

  const denom = 8;
  const whole = Math.floor(x);
  const frac = x - whole;
  const nume = Math.round(frac * denom);

  if (nume === 0) return String(whole);
  if (nume === denom) return String(whole + 1);

  const gcd = (a,b)=>b?gcd(b,a%b):a;
  const g = gcd(nume, denom);
  const n = nume / g;
  const d = denom / g;

  if (whole === 0) return `${n}/${d}`;
  return `${whole} ${n}/${d}`;
}

function popupHTML(r, dAlt){
  const tmp = num(r.tmpf);
  const dew = num(r.dwpf);
  const drct = num(r.drct);
  const sknt = num(r.sknt);
  const gust = num(r.gust);
  const alti = num(r.alti);

  const mph  = sknt != null ? Math.round(ktToMph(sknt)) : "";
  const gmh  = gust != null ? Math.round(ktToMph(gust)) : "";
  const altTxt = alti != null ? alti.toFixed(2) : "";
  const dTxt = (dAlt == null) ? "" : `${dAlt > 0 ? "+" : ""}${dAlt.toFixed(2)} in/3h`;

  const visObj = parseVisMiles(r.vsby);
  const visTxt = (visObj.label || r.vsby || "");

  const toDir = (drct != null) ? ((drct + 180) % 360) : null;

  return `
    <div style="font:600 13px/1.3 Arial,sans-serif">
      <div style="font-size:14px;margin-bottom:4px"><b>${r.station || "Station"}</b></div>
      <div style="opacity:.85;margin-bottom:6px">Valid: ${r.valid || ""} UTC</div>
      <div>Temp: <b>${tmp == null ? "" : Math.round(tmp)}</b> F</div>
      <div>Dew Pt: <b>${dew == null ? "" : Math.round(dew)}</b> F</div>
      <div>Wind: <b>${mph}</b> mph (gust <b>${gmh}</b>)</div>
      <div>Wind dir (FROM): <b>${drct == null ? "" : drct.toFixed(0)}</b></div>
      <div>Arrow points (TO): <b>${toDir == null ? "" : toDir.toFixed(0)}</b></div>
      <div>Vis: <b>${visTxt}</b> mi</div>
      <div>Altimeter: <b>${altTxt}</b> inHg</div>
      <div>Alt trend (3h): <b>${dTxt}</b></div>
      <div>Wx: <b>${(r.wxcodes || "").trim() || ""}</b></div>
    </div>
  `;
}

/* ------------------------------------------------------------
   9) METAR fetch
------------------------------------------------------------ */
const reportType = 3;
const SD_ONLY = ["SD_ASOS"];
const REST = ["MN_ASOS","IA_ASOS","NE_ASOS","ND_ASOS","WI_ASOS","IL_ASOS","MI_ASOS"];

function asosURL(d, networks){
  const iso = toISOZ(d);
  return "https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py"
    + "?data=tmpf&data=dwpf&data=drct&data=sknt&data=gust&data=vsby&data=alti&data=wxcodes"
    + `&network=${encodeURIComponent(networks.join(","))}`
    + `&report_type=${reportType}`
    + "&latlon=yes&format=onlycomma&tz=UTC"
    + `&sts=${encodeURIComponent(iso)}`
    + `&ets=${encodeURIComponent(iso)}`
    + "&missing=empty";
}

function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l => l.trim() && !l.startsWith("#"));
  if (lines.length < 2) return [];
  const header = lines[0].split(",");
  return lines.slice(1).map(line => {
    const cols = line.split(",");
    const obj = {};
    header.forEach((h,i)=>obj[h]=cols[i] ?? "");
    return obj;
  });
}

async function fetchRows(d, networks){
  const resp = await fetch(asosURL(d, networks), { cache:"no-store" });
  if (!resp.ok) throw new Error(`METAR HTTP ${resp.status}`);
  return parseCSV(await resp.text());
}

/* ------------------------------------------------------------
   10) Alerts styling + LOADER (UPDATED for your new filenames)
------------------------------------------------------------ */
const NWS_EVENT_COLOR = {
  // Severe / Flood (from NWS Hazards Map colors)
  "Tornado Warning": "#FF0000",
  "Severe Thunderstorm Warning": "#FFA500",
  "Flash Flood Warning": "#8B0000",
  "Flash Flood Watch": "#2E8B57",
  "Flood Warning": "#00FF00",
  "Flood Advisory": "#00FF7F",
  "Flood Watch": "#2E8B57",

  // Winter
  "Blizzard Warning": "#FF4500",
  "Winter Storm Warning": "#FF69B4",
  "Winter Storm Watch": "#4682B4",
  "Winter Weather Advisory": "#7B68EE",
  "Ice Storm Warning": "#8B008B",
  "Snow Squall Warning": "#C71585",

  // Wind / Other
  "High Wind Warning": "#DAA520",
  "Wind Advisory": "#D2B48C",
  "Dense Fog Advisory": "#708090"
};

function pickProp(p, keys){
  if (!p) return "";
  for (const k of keys){
    if (p[k] != null && String(p[k]).trim() !== "") return String(p[k]).trim();
    const kk = Object.keys(p).find(x => x.toLowerCase() === k.toLowerCase());
    if (kk && p[kk] != null && String(p[kk]).trim() !== "") return String(p[kk]).trim();
  }
  return "";
}

function eventNameFromProps(p){
  const e = pickProp(p, ["event","headline","name","title"]);
  if (e) return e;

  const phen = pickProp(p, ["phenomena","phenom","PHENOM","phen"]);
  const sig  = pickProp(p, ["significance","sig","SIG"]);
  if (phen && sig){
    const key = `${phen}.${sig}`.toUpperCase();
    // Common VTEC phenom.sig -> human name
    const MAP = {
      'BZ.W':'Blizzard Warning',
      'WS.W':'Winter Storm Warning',
      'WS.A':'Winter Storm Watch',
      'WW.Y':'Winter Weather Advisory',
      'ZR.Y':'Freezing Rain Advisory',
      'IS.W':'Ice Storm Warning',
      'SQ.W':'Snow Squall Warning',

      'TO.W':'Tornado Warning',
      'TO.A':'Tornado Watch',
      'SV.W':'Severe Thunderstorm Warning',
      'SV.A':'Severe Thunderstorm Watch',
      'FF.W':'Flash Flood Warning',
      'FF.A':'Flash Flood Watch',
      'FA.W':'Flood Warning',
      'FA.Y':'Flood Advisory',
      'FL.W':'Flood Warning',
      'FL.Y':'Flood Advisory',

      'MA.W':'Marine Warning',
      'GL.W':'Gale Warning',
      'SR.W':'Storm Warning'
    };
    if (MAP[key]) return MAP[key];
    return key;
  }

  const wfo = pickProp(p, ["WFO","wfo"]);
  const etn = pickProp(p, ["ETN","etn"]);
  return (wfo || etn) ? `Alert ${wfo || ""} ${etn || ""}`.trim() : "Alert";
}

function colorForAlertName(name){
  if (NWS_EVENT_COLOR[name]) return NWS_EVENT_COLOR[name];
  const lower = String(name).toLowerCase();
  if (lower.includes("blizzard") && lower.includes("warning")) return NWS_EVENT_COLOR["Blizzard Warning"];
  if (lower.includes("winter storm") && lower.includes("warning")) return NWS_EVENT_COLOR["Winter Storm Warning"];
  if (lower.includes("winter storm") && lower.includes("watch")) return NWS_EVENT_COLOR["Winter Storm Watch"];
  if (lower.includes('winter weather') && lower.includes('advisory')) return NWS_EVENT_COLOR['Winter Weather Advisory'];
  if (lower.includes('tornado') && lower.includes('warning')) return NWS_EVENT_COLOR['Tornado Warning'];
  if (lower.includes('tornado') && lower.includes('watch')) return NWS_EVENT_COLOR['Tornado Watch'];
  if (lower.includes('severe thunderstorm') && lower.includes('warning')) return NWS_EVENT_COLOR['Severe Thunderstorm Warning'];
  if (lower.includes('severe thunderstorm') && lower.includes('watch')) return NWS_EVENT_COLOR['Severe Thunderstorm Watch'];
  if (lower.includes('flash flood') && lower.includes('warning')) return NWS_EVENT_COLOR['Flash Flood Warning'];
  if (lower.includes('flash flood') && lower.includes('watch')) return NWS_EVENT_COLOR['Flash Flood Watch'];
  if (lower == 'flood warning') return NWS_EVENT_COLOR['Flood Warning'];
  if (lower == 'flood advisory') return NWS_EVENT_COLOR['Flood Advisory'];
  return '#CC0000'; // fallback

}

// NEW (your repo): alerts_20180414_0000Z.geojson
function alertsFileCompactHourly(d){
  const Y = d.getUTCFullYear();
  const M = String(d.getUTCMonth()+1).padStart(2,"0");
  const D = String(d.getUTCDate()).padStart(2,"0");
  const H = String(d.getUTCHours()).padStart(2,"0");
  return `./alerts_${Y}${M}${D}_${H}00Z.geojson`;
}

// OLD (your repo): alerts_2018-04-14T21Z.geojson
function alertsFileOldDash(d){
  const Y = d.getUTCFullYear();
  const M = String(d.getUTCMonth()+1).padStart(2,"0");
  const D = String(d.getUTCDate()).padStart(2,"0");
  const H = String(d.getUTCHours()).padStart(2,"0");
  return `./alerts_${Y}-${M}-${D}T${H}Z.geojson`;
}

// Extra fallback (sometimes people store T2100Z)
function alertsFileOldWithMinutes(d){
  const Y = d.getUTCFullYear();
  const M = String(d.getUTCMonth()+1).padStart(2,"0");
  const D = String(d.getUTCDate()).padStart(2,"0");
  const H = String(d.getUTCHours()).padStart(2,"0");
  return `./alerts_${Y}-${M}-${D}T${H}00Z.geojson`;
}

async function fetchFirstOk(urls){
  let lastErr = "";
  for (const u of urls){
    try{
      const r = await fetch(u, { cache:"no-store" });
      if (!r.ok) { lastErr = `HTTP ${r.status}`; continue; }
      const gj = await r.json();
      return { url: u, gj };
    } catch(e){
      lastErr = e.message || String(e);
    }
  }
  throw new Error(lastErr || "No alert file matched");
}

async function loadAlerts(){
  if (!map.hasLayer(alertsLayer)) return;

  // If you have a timeline_index.json + timeline_hourly/*.geojson, use it.
  const snapped = snapCurrentToAlertsTimeline();

  let candidates = [];
  if (snapped && snapped.file){
    candidates = [ './' + snapped.file.replace(/^\.\//, '') ];
  } else {
    // Backward compatibility: try legacy naming patterns
    candidates = [
      alertsFileCompactHourly(current),
      alertsFileOldDash(current),
      alertsFileOldWithMinutes(current)
    ];
  }

  try{
    const { url, gj } = await fetchFirstOk(candidates);

    alertsLayer.clearLayers();

    let polyCount = 0;
    L.geoJSON(gj, {
      style: (feat) => {
        const p = feat.properties || {};
        const name = eventNameFromProps(p);
        const c = colorForAlertName(name);
        return { weight:2, color:c, fillColor:c, fillOpacity:0.18 };
      },
      onEachFeature: (feat, layer) => {
        polyCount++;
        const p = feat.properties || {};
        const name = eventNameFromProps(p);
        const c = colorForAlertName(name);

        const wfo = pickProp(p, ['WFO','wfo']);
        const etn = pickProp(p, ['ETN','etn']);
        const status = pickProp(p, ['STATUS','status']);
        const issued = pickProp(p, ['issuance','issued','onset','ISSUANCE','ISSUED','ISSUE']);
        const expire = pickProp(p, ['expire','expires','end','EXPIRE','EXPIRES']);

        const lines = [];
        lines.push(`<div><span class="swatch" style="background:${c}"></span><b>${name}</b></div>`);
        if (wfo || etn) lines.push(`Office/Event: <b>${wfo || ''}</b> / <b>${etn || ''}</b>`);
        if (status) lines.push(`Status: <b>${status}</b>`);
        if (issued) lines.push(`Issued: <b>${issued}</b>`);
        if (expire) lines.push(`Expires: <b>${expire}</b>`);

        layer.bindPopup(lines.join('<br>'));
      }
    }).eachLayer(l => alertsLayer.addLayer(l));

    // Confirm which file loaded + how many polygons
    const short = url.replace('./','');
    setStatus(`Alerts loaded: ${short} | polygons: ${polyCount}`);

  } catch(e){
    console.warn('Alerts load failed:', e.message);
    alertsLayer.clearLayers();
    setStatus('Alerts not found for this hour (check filenames).');
  }
}

/* ------------------------------------------------------------
   11) Daily particles (toggle + day buttons)
------------------------------------------------------------ */
function particlesFileForDay(dayNum){
  return `./wind_particles_201804${String(dayNum).padStart(2,"0")}.json`;
}

function normalizeVelocityJson(raw){
  if (Array.isArray(raw)) return raw;
  if (raw && Array.isArray(raw.data)) return raw.data;
  return raw;
}

async function refreshParticlesIfOn(){
  if (!map.hasLayer(particlesToggle)) return;

  if (typeof L.velocityLayer !== "function"){
    setStatus("Wind particles: leaflet-velocity did not load.");
    return;
  }

  const url = particlesFileForDay(particleDay);

  try{
    const r = await fetch(url, { cache:"no-store" });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const raw = await r.json();
    const velData = normalizeVelocityJson(raw);

    if (particlesLayer){
      try { map.removeLayer(particlesLayer); } catch(_) {}
      particlesLayer = null;
    }

    particlesLayer = L.velocityLayer({
      data: velData,
      velocityScale: 0.004,
      particleAge: 120,
      particleMultiplier: 1/900,
      lineWidth: 1.7,
      colorScale: [
        "rgb(0,40,160)",
        "rgb(0,120,255)",
        "rgb(0,210,180)",
        "rgb(255,220,0)",
        "rgb(255,120,0)"
      ],
      minVelocity: 0,
      maxVelocity: 60,
      displayValues: false
    });

    particlesLayer.addTo(map);
    setStatus(`Particles loaded: ${url.replace("./","")}`);

  } catch(e){
    console.warn("Particles failed:", url, e.message);
    setStatus(`Particles not found: ${url.replace("./","")}`);
  }
}

/* Toggle handlers for particles + alerts */
map.on("overlayadd", async (e) => {
  if (e.layer === particlesToggle) await refreshParticlesIfOn();
  if (e.layer === alertsLayer) await loadAlerts();
});
map.on("overlayremove", (e) => {
  if (e.layer === particlesToggle && particlesLayer){
    map.removeLayer(particlesLayer);
    particlesLayer = null;
  }
});

/* ------------------------------------------------------------
   12) Main refresh (METAR + alerts + arrows)
------------------------------------------------------------ */
async function refreshAll(){
  setStatus("Loading METARs");

  const prev = new Date(current.getTime() - stepHours*3600*1000);

  const [sdNow, restNow, sdPrev, restPrev] = await Promise.all([
    fetchRows(current, SD_ONLY),
    fetchRows(current, REST),
    fetchRows(prev, SD_ONLY),
    fetchRows(prev, REST)
  ]);

  const rowsNow  = sdNow.concat(restNow);
  const rowsPrev = sdPrev.concat(restPrev);

  const prevAlt = new Map();
  for (const r of rowsPrev){
    const st = (r.station || "").trim();
    const a  = num(r.alti);
    if (st && a != null) prevAlt.set(st, a);
  }

  [tempLayer, dewLayer, windNumLayer, windArrowLayer, gustLayer, visLayer, presLayer, wxLayer].forEach(l => l.clearLayers());

  const z = map.getZoom();
  const minSep = minSepForZoom(z);

  const idxTemp = new CollisionIndex(Math.max(24, minSep));
  const idxDew  = new CollisionIndex(Math.max(24, minSep));
  const idxWind = new CollisionIndex(Math.max(24, minSep));
  const idxGust = new CollisionIndex(Math.max(24, minSep));
  const idxVis  = new CollisionIndex(Math.max(24, minSep));
  const idxPres = new CollisionIndex(Math.max(24, minSep));
  const idxWx   = new CollisionIndex(Math.max(24, minSep));
  const idxArr  = new CollisionIndex(Math.max(30, minSep));

  let shown = 0, total = 0;

  for (const r of rowsNow){
    const lat = num(r.lat), lon = num(r.lon);
    if (lat == null || lon == null) continue;
    total++;

    const st = (r.station || "").trim();
    const alti = num(r.alti);
    const prevA = st ? prevAlt.get(st) : null;
    const dAlt = (alti != null && prevA != null) ? (alti - prevA) : null;

    const popup = popupHTML(r, dAlt);

    const tmp = num(r.tmpf);
    const dew = num(r.dwpf);

    const drct = num(r.drct);
    const sknt = num(r.sknt);
    const gust = num(r.gust);

    const mph  = sknt != null ? ktToMph(sknt) : null;
    const gmh  = gust != null ? ktToMph(gust) : null;

    const visObj = parseVisMiles(r.vsby);
    const visMi = visObj.miles;

    if (tmp != null && allowByCollision(idxTemp, lat, lon, minSep)){
      L.marker([lat,lon], { icon: dotIcon(String(Math.round(tmp)), tempColorF(tmp), 28, 12) })
        .bindPopup(popup).addTo(tempLayer);
    }

    if (dew != null && allowByCollision(idxDew, lat, lon, minSep)){
      L.marker([lat,lon], { icon: dotIcon(String(Math.round(dew)), dewColorF(dew), 28, 12) })
        .bindPopup(popup).addTo(dewLayer);
    }

    if (mph != null && allowByCollision(idxWind, lat, lon, minSep)){
      L.marker([lat,lon], { icon: dotIcon(String(Math.round(mph)), windColorMph(mph), 28, 12) })
        .bindPopup(popup).addTo(windNumLayer);
    }

    if (mph != null && drct != null && allowByCollision(idxArr, lat, lon, minSep)){
      const toDir = (drct + 180) % 360;
      L.marker([lat,lon], { icon: windArrowIcon(toDir, mph) })
        .bindPopup(popup).addTo(windArrowLayer);
    }

    if (gmh != null && allowByCollision(idxGust, lat, lon, minSep)){
      L.marker([lat,lon], { icon: dotIcon(String(Math.round(gmh)), windColorMph(gmh), 30, 12) })
        .bindPopup(popup).addTo(gustLayer);
    }

    if ((visObj.label || "").trim() && allowByCollision(idxVis, lat, lon, minSep)){
      const style = visStyle(visMi);
      L.marker([lat,lon], { icon: dotIcon(visObj.label, style.bg, 30, 11, style.border) })
        .bindPopup(popup).addTo(visLayer);
    }

    if (alti != null && allowByCollision(idxPres, lat, lon, minSep)){
      const fill = pressureTrendColor(dAlt);
      L.marker([lat,lon], { icon: dotIcon(alti.toFixed(2), fill, 44, 12, "#999") })
        .bindPopup(popup).addTo(presLayer);
    }

    const wx = (r.wxcodes || "").trim();
    if (wx && allowByCollision(idxWx, lat, lon, minSep)){
      L.marker([lat,lon], { icon: dotIcon(wx, "rgba(255,255,255,0.85)", 30, 10, "#999") })
        .bindPopup(popup).addTo(wxLayer);
    }

    shown++;
  }

  setStatus(`Stations shown: ${shown}/${total} (minSep ${minSep}px).`);

  await loadAlerts();
}

refreshAll().catch(err => {
  console.error(err);
  setStatus("Error: " + err.message);
});
</script>

</body>